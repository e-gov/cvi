(self.webpackChunkcvi_components=self.webpackChunkcvi_components||[]).push([[6152],{"./libs/ng-diagrams/src/lib/hierarchical-box-diagram/hierarchical-box-diagram.component.stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>hierarchical_box_diagram_component_stories});var tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");var HierarchicalBoxDiagramComponent_1,hierarchical_box_diagram_componentngResource=__webpack_require__("./libs/ng-diagrams/src/lib/hierarchical-box-diagram/hierarchical-box-diagram.component.scss?ngResource"),hierarchical_box_diagram_componentngResource_default=__webpack_require__.n(hierarchical_box_diagram_componentngResource),core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),src=__webpack_require__("./node_modules/d3/src/index.js");let HierarchicalBoxDiagramComponent=class HierarchicalBoxDiagramComponent{static#_=HierarchicalBoxDiagramComponent_1=this;static#_2=this.PADDING={HORIZONTAL:16,VERTICAL:8};static#_3=this.BOX_PARAMS={MAX_BOX_WIDTH:100,MAX_BOX_HEIGHT:50,LINE_HEIGHT:"18px",FONT_SIZE:"14px",FONT_FAMILY:"Roboto, sans-serif"};constructor(elementRef,ngZone,cdRef){this.elementRef=elementRef,this.ngZone=ngZone,this.cdRef=cdRef,this.ariaLabel="Hierarchical box diagram",this.svg=null}ngOnChanges(changes){changes.boxes?.currentValue&&this.createDiagram()}ngOnDestroy(){this.removeSvg()}onResize(){this.createDiagram()}createDiagram(){this.ngZone.runOutsideAngular((()=>{this.setupDiagram(),this.cdRef.markForCheck()}))}setupDiagram(){this.removeSvg(),this.createSvg(),this.calculateBoxDimensions(),this.drawGraph()}drawGraph(){const{rootNode,additionalLinks}=this.toHierarchy(this.boxes);if(!rootNode)return;const root=src.oVi(rootNode),containerWidth=this.container.nativeElement.clientWidth,containerHeight=this.container.nativeElement.clientHeight,{BOX_PARAMS}=HierarchicalBoxDiagramComponent_1,rootWidth=1.5*BOX_PARAMS.MAX_BOX_WIDTH,hierarchy=(0,src.sNE)().size([containerHeight,containerWidth-rootWidth]).separation(((a,b)=>this.calculateSeparation(a,b)))(root),nodes=hierarchy.descendants();for(let i=0;i<nodes.length;i++)for(let j=i+1;j<nodes.length;j++)for(;this.boxesOverlap(nodes[i],nodes[j]);){const centerVertical=this.container.nativeElement.clientHeight/2;nodes[j].x<centerVertical?nodes[j].x-=BOX_PARAMS.MAX_BOX_HEIGHT/2:nodes[j].x+=BOX_PARAMS.MAX_BOX_HEIGHT/2}const links=hierarchy.links(),additionalMappedLinks=additionalLinks.map((link=>this.mapLinkToNodes(link,nodes))),combinedLinks=links.concat(additionalMappedLinks);this.drawLines(combinedLinks),this.drawBoxes(nodes)}createSvg(){const containerWidth=this.container.nativeElement.clientWidth,containerHeight=this.container.nativeElement.clientHeight,{BOX_PARAMS}=HierarchicalBoxDiagramComponent_1,viewBoxX=-BOX_PARAMS.MAX_BOX_WIDTH/1.5;this.svg=src.MlD(this.container.nativeElement).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",`${viewBoxX} 0 ${containerWidth} ${containerHeight}`)}drawLines(links){this.svg.selectAll(".link").data(links).enter().append("path").attr("class","link").attr("d",this.calculateLinkPath).attr("fill","none").attr("stroke","#D2D3D8").attr("stroke-width",2)}calculateLinkPath(d){const sourceX=d.source.y,sourceY=d.source.x,targetX=d.target.y,targetY=d.target.x,midXSource=sourceX,midYSource=(sourceY+sourceY+d.source.height)/2,midXTarget=targetX,midYTarget=(targetY+targetY+d.target.height)/2;return sourceY<targetY||sourceY>targetY?`M ${sourceX} ${sourceY} L ${midXSource} ${midYSource} L ${midXSource} ${midYTarget} L ${midXTarget} ${midYTarget} L ${targetX} ${targetY}`:`M ${sourceX} ${sourceY} L ${targetX} ${targetY}`}drawBoxes(nodes){const boxAnchor=this.svg.selectAll(".box").data(nodes).enter().append("g").attr("class","box").attr("transform",(d=>`translate(${d.y},${d.x})`)).append("a").each((function(d){const href=d.data.data.href;href&&src.MlD(this).attr("href",href)}));boxAnchor.append("title").text((d=>`Diagram box for ${d.data.data.label}`)),boxAnchor.attr("tabindex","0");const idToLabelLookup=nodes.reduce(((acc,boxNode)=>(acc[boxNode.data.data.id]=boxNode.data.data.label,acc)),{});boxAnchor.append("desc").text((d=>{let description=`Box labeled ${d.data.data.label}.`;if(d.parent&&(description+=` This box is a child of ${d.parent.data.data.label}.`),d.data.data.targets&&d.data.data.targets.length>0){description+=` This box links to boxes labeled: ${d.data.data.targets.map((targetId=>idToLabelLookup[targetId]||targetId)).join(", ")}.`}return description})),boxAnchor.append("rect").attr("x",(d=>-(d.data.data.width||100)/2)).attr("y",(d=>-(d.data.data.height||50)/2)).attr("width",(d=>d.data.data.width||100)).attr("height",(d=>d.data.data.height||50)).attr("rx",5).attr("ry",5).attr("fill",(d=>d.data.data.color)).attr("stroke",(d=>"dotted"===d.data.data.borderStyle||"solid"===d.data.data.borderStyle?d.data.data.borderColor||this.darkenColor(d.data.data.color):"none")).attr("stroke-dasharray",(d=>"dotted"===d.data.data.borderStyle?"4,5":"")).attr("stroke-width",2);const{BOX_PARAMS}=HierarchicalBoxDiagramComponent_1;boxAnchor.append("foreignObject").attr("x",(d=>-(d.data.data.width||100)/2)).attr("y",(d=>-(d.data.data.height||50)/2)).attr("width",(d=>d.data.data.width||100)).attr("height",(d=>d.data.data.height||50)).html((d=>`<div class="box-content">${d.data.data.label}</div>`)).style("font-size",BOX_PARAMS.FONT_SIZE).style("line-height",BOX_PARAMS.LINE_HEIGHT)}toHierarchy(boxes){const nodeMap={},additionalLinks=[];boxes.forEach((box=>nodeMap[box.id]={data:box}));const rootNode=nodeMap[1],queue=[rootNode];for(;queue.length;){const currentNode=queue.shift();currentNode?.data.targets&&(currentNode.children=[],currentNode.data.targets.forEach((targetId=>{if(!nodeMap[targetId])return;const childNode=nodeMap[targetId];if(childNode.parent){const link={source:currentNode.data.id,target:childNode.data.id};this.linkExists(additionalLinks,link)||additionalLinks.push(link)}else childNode.parent=currentNode,currentNode.children?.push(childNode),queue.push(childNode)})))}return{rootNode,additionalLinks}}linkExists(links,link){return links.some((l=>l.source===link.source&&l.target===link.target||l.source===link.target&&l.target===link.source))}calculateBoxDimensions(){const{PADDING,BOX_PARAMS}=HierarchicalBoxDiagramComponent_1,MAX_WIDTH=BOX_PARAMS.MAX_BOX_WIDTH,measureDiv=this.measureDiv?.nativeElement;measureDiv.style.boxSizing="border-box",measureDiv.style.fontSize=BOX_PARAMS.FONT_SIZE,measureDiv.style.lineHeight=BOX_PARAMS.LINE_HEIGHT,measureDiv.style.fontFamily=BOX_PARAMS.FONT_FAMILY,this.boxes.forEach((box=>{measureDiv.innerHTML=box.label;const rect=measureDiv.getBoundingClientRect(),width=rect.width,initialHeight=rect.height,renderedText=measureDiv.innerText||measureDiv.textContent;if(!/\s/.test(renderedText)&&width>MAX_WIDTH)box.width=width,box.height=initialHeight+PADDING.VERTICAL;else if(width>MAX_WIDTH){const overflowRatio=width/MAX_WIDTH;box.width=MAX_WIDTH+PADDING.HORIZONTAL,box.height=initialHeight*overflowRatio+PADDING.VERTICAL}else box.width=width+PADDING.HORIZONTAL,box.height=initialHeight+PADDING.VERTICAL;measureDiv.innerHTML="",measureDiv.removeAttribute("style")}))}darkenColor(color,percent=-40){const num=parseInt(color.slice(1),16),amt=Math.round(2.55*percent);return"#"+(1<<24|(num>>16)+amt<<16|(num>>8&255)+amt<<8|(255&num)+amt).toString(16).slice(1).toUpperCase()}mapLinkToNodes(link,nodes){return{source:nodes.find((node=>node.data.data.id===link.source)),target:nodes.find((node=>node.data.data.id===link.target))}}calculateSeparation(a,b){const{BOX_PARAMS}=HierarchicalBoxDiagramComponent_1,additionalSeparation=Math.abs(a.x-b.x)<BOX_PARAMS.MAX_BOX_HEIGHT?.5:0;return a.parent==b.parent?1+additionalSeparation:2+additionalSeparation}boxesOverlap(first,second){const halfWidth1=(first.data.data.width??0)/2+5,halfHeight1=(first.data.data.height??0)/2+5,halfWidth2=(second.data.data.width??0)/2+5,halfHeight2=(second.data.data.height??0)/2+5;return first.y+halfWidth1>second.y-halfWidth2&&first.y-halfWidth1<second.y+halfWidth2&&first.x+halfHeight1>second.x-halfHeight2&&first.x-halfHeight1<second.x+halfHeight2}removeSvg(){if(this.svg){this.svg.remove();const svgElement=this.container.nativeElement.querySelector("svg");svgElement&&svgElement.parentNode.removeChild(svgElement)}}static#_4=this.ctorParameters=()=>[{type:core.ElementRef},{type:core.NgZone},{type:core.ChangeDetectorRef}];static#_5=this.propDecorators={measureDiv:[{type:core.ViewChild,args:["measureDiv",{static:!0}]}],container:[{type:core.ViewChild,args:["container",{static:!0}]}],boxes:[{type:core.Input}],ariaLabel:[{type:core.Input}],onResize:[{type:core.HostListener,args:["window:resize",["$event"]]}]}};HierarchicalBoxDiagramComponent=HierarchicalBoxDiagramComponent_1=(0,tslib_es6.UN)([(0,core.Component)({selector:"cvi-ng-hierarchical-box-diagram",template:'<div #container class="svg-diagram-container" role="region" [attr.aria-label]=ariaLabel></div>\n<div #measureDiv class="hidden-measure-helper"></div>\n',encapsulation:core.ViewEncapsulation.None,changeDetection:core.ChangeDetectionStrategy.OnPush,styles:[hierarchical_box_diagram_componentngResource_default()]}),(0,tslib_es6.YR)("design:paramtypes",[core.ElementRef,core.NgZone,core.ChangeDetectorRef])],HierarchicalBoxDiagramComponent);const hierarchical_box_diagram_component_stories={title:"Angular Diagrams/Hierarchical Box Diagram",component:HierarchicalBoxDiagramComponent,parameters:{docs:{description:{component:"## General Description\n\n| Feature  | Description                               |\n|----------|-------------------------------------------|\n| Angular Component | `HierarchicalBoxDiagramComponent`    |\n| Corresponding Typescript Class | `HierarchicalBoxDiagramComponent` |\n| Permitted Parent/Ancestors | Any                            |\n| Permitted Angular Components as Children | None          |\n\n## Where to Use\n\nThis component is designed to display a diagram that illustrates hierarchical relationships between different elements. It's useful in scenarios like visualizing workflows, decision trees, or file system structures.\n\n## How to Use\n\n### In Angular Template\n\nAdd the `cvi-ng-hierarchical-box-diagram` tag to your HTML template:\n\n```html\n<cvi-ng-hierarchical-box-diagram [boxes]=\"yourBoxArray\"></cvi-ng-hierarchical-box-diagram>\n```\n\n### In TypeScript\n\nDefine a `boxes` array within your Angular component's TypeScript file. Then bind it to the `[boxes]` input attribute of the `cvi-ng-hierarchical-box-diagram` component.\n\n```typescript\nboxes = [\n{\nid: '1',\nhref: 'https://example.com/1',\nlabel: '<p style=\"color:#D73E3E\">Health concern</p>',\ntargets: ['2', '7'],\n// ...additional style properties\n},\n// ...other boxes\n];\n```\n\n### Box Properties\n\nEach object in the `boxes` array must include:\n\nid: string;\nlabel: string;\ncolor: string;\nborderStyle: 'none' | 'dotted' | 'solid';\nborderColor?: string;\ntargets?: string[];\nhref?: string;\n\n- `id`: A unique identifier for each box.\n- `label`: The label to display inside the box.\n- `color`: A color for the box fill. Valid values are all hex and color codes.\n\n- Each object in the boxes array may define:\n- `targets`: An array of `id`s representing target boxes that this box connects to. Optional.\n- `href`: The URL to which the box links. Since the label can be html then the user can make specific parts of the label as links and not use this option if the goal is to have embedded links. Optional.\n- `borderColor`: A color for the border, default is the same as the box color. Valid values are all hex and color codes. Optional.\n- `borderStyle`: A style for the border, default is none. Allowed values 'none', 'dotted', 'solid'. Optional.\n\n#### Example\n\n```typescript\n{\nid: '1',\ncolor: '#F0F0F2'\nhref: 'https://example.com/1',\nlabel: '<p style=\"color:#D73E3E\">Health concern</p>',\ntargets: ['2', '7'],\nborderStyle: 'solid'\nborderColor: '#D73E3E'\n},\n{\nid: '2',\ncolor: '#F0F0F2'\nhref: 'https://example.com/2',\nlabel: '<p style=\"color:#D73E3E\">Health concern 2</p>',\ntargets: [],\nborderStyle: 'solid'\nborderColor: '#D73E3E'\n},\n{\nid: '7',\ncolor: '#F0F0F2'\nhref: 'https://example.com/7',\nlabel: '<p style=\"color:#D73E3E\">Health concern 7</p>',\ntargets: [],\nborderStyle: 'solid'\nborderColor: '#D73E3E'\n}\n```\n\nThis creates a single box with a solid red border, linking to `https://example.com/1`, and labeled as \"Health concern.\".\nThe first box is connected to two other boxes with id's 2 and 7.\n---\n\nFeel free to modify, extend, or customize your `boxes` array as needed for your specific use-case.\n"}},layout:"fullscreen",backgrounds:{default:"default",values:[{name:"default",value:"#ffffff"}]},viewport:{defaultViewport:"custom",viewports:{custom:{name:"Custom Viewport",styles:{width:"800px",height:"400px"}}}}}},Default={args:{boxes:[{...baseBoxStyles("#F0F0F2","solid","#D73E3E"),id:"1",href:"https://example.com/1",label:'<p style="color:#D73E3E">Health concern</p>',targets:["2","7"]},...function defaultBoxes(boxes){return boxes.map((box=>({...baseBoxStyles("#FFF1D3"),...box})))}([{id:"2",href:"https://example.com/2",label:"I have a minor health issue",targets:["3","4","5"]},{id:"3",href:"https://example.com/3",label:"Pharmacy"},{id:"4",href:"https://example.com/4",label:"Helpline 1220"},{id:"5",href:"https://example.com/5",label:"<b>Family doctor</b>",targets:["6","9"]}]),{...dottedBoxStyles("#B9D2E5","#3B85BD"),id:"6",href:"https://example.com/6",label:"Specialist doctor",targets:["9"]},{...baseBoxStyles("#CECFD8"),id:"9",href:"https://example.com/9",label:"Conclusions/Referrals",targets:["10","11"]},{...dottedBoxStyles("#ECF4EF","#399E43"),id:"10",href:"https://example.com/10",label:"Treatment at home"},{...baseBoxStyles("#FBEDED"),id:"7",href:"https://example.com/7",label:"I have an acute health issue and need emergency care",targets:["8"]},{...baseBoxStyles("#FCEEEE"),id:"8",href:"https://example.com/8",label:"<b>Call 112 or go to ER</b>",targets:["11"]},{...dottedBoxStyles("#FCEEEE","#D73E3E"),id:"11",href:"https://example.com/11",label:"Hospitalization",targets:["9"]}]}};function baseBoxStyles(color,borderStyle="none",borderColor="transparent"){return{color,borderStyle,borderColor}}function dottedBoxStyles(color,borderColor){return{...baseBoxStyles(color,"dotted",borderColor)}}Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  args: {\n    boxes: [{\n      ...baseBoxStyles('#F0F0F2', 'solid', '#D73E3E'),\n      id: '1',\n      href: 'https://example.com/1',\n      label: '<p style=\"color:#D73E3E\">Health concern</p>',\n      targets: ['2', '7']\n    }, ...defaultBoxes([{\n      id: '2',\n      href: 'https://example.com/2',\n      label: 'I have a minor health issue',\n      targets: ['3', '4', '5']\n    }, {\n      id: '3',\n      href: 'https://example.com/3',\n      label: 'Pharmacy'\n    }, {\n      id: '4',\n      href: 'https://example.com/4',\n      label: 'Helpline 1220'\n    }, {\n      id: '5',\n      href: 'https://example.com/5',\n      label: '<b>Family doctor</b>',\n      targets: ['6', '9']\n    }]), {\n      ...dottedBoxStyles('#B9D2E5', '#3B85BD'),\n      id: '6',\n      href: 'https://example.com/6',\n      label: 'Specialist doctor',\n      targets: ['9']\n    }, {\n      ...baseBoxStyles('#CECFD8'),\n      id: '9',\n      href: 'https://example.com/9',\n      label: 'Conclusions/Referrals',\n      targets: ['10', '11']\n    }, {\n      ...dottedBoxStyles('#ECF4EF', '#399E43'),\n      id: '10',\n      href: 'https://example.com/10',\n      label: 'Treatment at home'\n    }, {\n      ...baseBoxStyles('#FBEDED'),\n      id: '7',\n      href: 'https://example.com/7',\n      label: 'I have an acute health issue and need emergency care',\n      targets: ['8']\n    }, {\n      ...baseBoxStyles('#FCEEEE'),\n      id: '8',\n      href: 'https://example.com/8',\n      label: '<b>Call 112 or go to ER</b>',\n      targets: ['11']\n    }, {\n      ...dottedBoxStyles('#FCEEEE', '#D73E3E'),\n      id: '11',\n      href: 'https://example.com/11',\n      label: 'Hospitalization',\n      targets: ['9']\n    }]\n  }\n}",...Default.parameters?.docs?.source}}};const __namedExportsOrder=["Default"]},"./libs/ng-diagrams/src/lib/hierarchical-box-diagram/hierarchical-box-diagram.component.scss?ngResource":(module,__unused_webpack_exports,__webpack_require__)=>{var ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),___CSS_LOADER_EXPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js")(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);___CSS_LOADER_EXPORT___.push([module.id,"a:hover {\n  text-decoration: none;\n}\n\n.hidden-measure-helper {\n  position: absolute;\n  top: -10000px;\n  visibility: hidden;\n}\n\n.svg-diagram-container {\n  height: 100%;\n  position: absolute;\n  width: 100%;\n}\n\n.box-content {\n  align-items: center;\n  border-width: 1px;\n  display: flex;\n  height: 100%;\n  justify-content: center;\n  overflow: hidden;\n  text-align: center;\n  width: 100%;\n  word-wrap: break-word;\n}\n\n.box-content.border-none {\n  border-style: none;\n}\n\n.box-content.border-dotted {\n  border-style: dotted;\n}",""]),module.exports=___CSS_LOADER_EXPORT___.toString()}}]);